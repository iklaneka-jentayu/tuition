<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CRUD no-cors</title>
<style>
body { font-family: Arial; padding: 20px; }
input { padding: 8px; margin: 5px; }
button { padding: 6px 10px; cursor: pointer; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; }
</style>
</head>
<body>

<h2>CRUD (no-cors POST)</h2>

<form id="form">
  <input type="hidden" id="rowIndex">
  <input type="text" id="name" placeholder="Name" required>
  <input type="email" id="email" placeholder="Email" required>
  <button type="submit">Save</button>
  <button type="button" onclick="resetForm()">Cancel</button>
</form>

<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Email</th>
<th>Action</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const WEB_APP_URL = "YOUR_WEB_APP_URL";

// CREATE / UPDATE
document.getElementById("form").addEventListener("submit", async function(e) {
  e.preventDefault();

  const rowIndex = document.getElementById("rowIndex").value;

  const data = {
    action: rowIndex ? "update" : "create",
    rowIndex: rowIndex,
    name: document.getElementById("name").value,
    email: document.getElementById("email").value
  };

  await fetch(WEB_APP_URL, {
    method: "POST",
    mode: "no-cors",   // ðŸ”¥ IMPORTANT
    headers: {
      "Content-Type": "text/plain"
    },
    body: JSON.stringify(data)
  });

  resetForm();

  // wait small delay before reload
  setTimeout(loadData, 800);
});

// DELETE
async function deleteRow(rowIndex) {
  if (!confirm("Delete this record?")) return;

  await fetch(WEB_APP_URL, {
    method: "POST",
    mode: "no-cors",
    headers: {
      "Content-Type": "text/plain"
    },
    body: JSON.stringify({
      action: "delete",
      rowIndex: rowIndex
    })
  });

  setTimeout(loadData, 800);
}

// READ (normal fetch)
async function loadData() {
  const response = await fetch(WEB_APP_URL);
  const result = await response.json();

  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  result.data.forEach(row => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${row.ID}</td>
      <td>${row.Name}</td>
      <td>${row.Email}</td>
      <td>
        <button onclick='editRow(${JSON.stringify(row)})'>Edit</button>
        <button onclick='deleteRow(${row.rowIndex})'>Delete</button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

function editRow(row) {
  document.getElementById("rowIndex").value = row.rowIndex;
  document.getElementById("name").value = row.Name;
  document.getElementById("email").value = row.Email;
}

function resetForm() {
  document.getElementById("form").reset();
  document.getElementById("rowIndex").value = "";
}

loadData();
</script>

</body>
</html>